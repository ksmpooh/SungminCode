~/bwa-mem2/bwa-mem2 mem -t 2 ./HLA.target.fasta ../733_S56_L002_R2_001.fastq.gz ../733_S56_L002_R1_001.fastq.gz >test_align.sam



#samtools view test.sam > test.bam

samtools sort test.bam
samtools index test.bam

sambamba view test.sam -o test.bam
sambamba sort test.bam




sudo docker run -v "/DATA/smkim/pacbio/INPUTs/Data":"/input" -v "/DATA/smkim/pacbio/OUTPUTs/GATK":"/output" -it broadinstitute/gatk \
bash -c 'gatk HaplotypeCaller \
-I /input/2020HLAseq001.movies.Q20.bam \
-R /output/HLA.target.fasta \
-O /output/test1.g.vcf.gz \
-ERC GVCF'


sudo docker run -v "/DATA/smkim/pacbio/INPUTs/Data":"/input" -v "/DATA/smkim/pacbio/OUTPUTs/GATK":"/output" -it broadinstitute/gatk \
bash -c 'gatk HaplotypeCaller \
-I /input/2020HLAseq001.movies.Q20.bam \
-R /output/HLA.target.fasta \
-O /output/test1.g.vcf.gz \
-ERC GVCF'



sudo docker run -v "/DATA/smkim/HLA_seq/MHC_Illumina_Rawdata/Fastq/test":"/input" -it broadinstitute/gatk \
bash -c 'gatk HaplotypeCaller \
-I /input/test_align_sorted.bam \
-R /input/HLA.target.fasta \
-O /input/test_align_sorted.gatk.gvcf.gz \
-ERC GVCF' \
--sample-name 733'

#-DGATK_STACKTRACE_ON_USER_EXCEPTION true \
#--native-pair-hmm-threads


#####
cd /DATA/smkim/HLA_seq/MHC_Illumina_Rawdata/Fastq/test


# Indexing the reference sequence (Requires 28N GB memory where N is the size of the reference sequence).
./bwa-mem2 index [-p prefix] <in.fasta>

./bwa-mem2 index [-p prefix] <in.fasta>
Where 
<in.fasta> is the path to reference sequence fasta file and 
<prefix> is the prefix of the names of the files that store the resultant index. Default is in.fasta.

# Mapping 
# Run "./bwa-mem2 mem" to get all options
./bwa-mem2 mem -t <num_threads> <prefix> <reads.fq/fa> > out.sam
Where <prefix> is the prefix specified when creating the index or the path to the reference fasta file in case no prefix was provided.

https://solution4u.tistory.com/10
bwa mem -M -R "@RG\tID:HWI\tSM:[샘플이름]\tPL:ILLUMINA\tLB:[기계]" -t 10 [참조유전체 fasta] [FASTQ.gz 1; 압축형태 이용가능] [FASTQ.gz 2]

~/bwa-mem2/bwa-mem2 mem -t 16 -R "@RG\tID:HWI\tSM:733\tPL:ILLUMINA\tLB:Novaseq7000" ./HLA.target.fasta ../733_S56_L002_R2_001.fastq.gz ../733_S56_L002_R1_001.fastq.gz >test_align.sam
samtools sort test_align.sam -o test_align_sorted.bam


##test
sudo docker run -v "/DATA/smkim/HLA_seq/MHC_Illumina_Rawdata/Fastq/test/":"/input" -v "/DATA/smkim/HLA_seq/MHC_Illumina_Rawdata/Fastq/test":"/output" -v "/DATA/smkim/pacbio/INPUTs":"/ref" google/deepvariant \
/opt/deepvariant/bin/run_deepvariant --model_type WGS --ref /ref/HLA.target.fasta \
--reads /input/test_align_sorted.bam --output_gvcf /output/test_align_sorted_deepvariant.gvcf.gz \
--output_vcf /output/test_align_sorted_deepvariant.vcf.gz --num_shards 20
